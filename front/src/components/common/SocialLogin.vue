<template>
  <div class="social-login">
    <div id="kakao-login">
      <button @click="kakaoLogin">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 55 55">
          <g id="그룹_247" data-name="그룹 247" transform="translate(-237 -406)">
            <g id="구성_요소_2" data-name="구성 요소 2" transform="translate(237 406)">
              <g id="타원_6" data-name="타원 6" fill="#ffd800" stroke="#eee" stroke-width="1">
                <circle cx="27.5" cy="27.5" r="27.5" stroke="none" />
                <circle cx="27.5" cy="27.5" r="27" fill="none" />
              </g>
            </g>
            <g id="kakaotalk_1_" data-name="kakaotalk (1)" transform="translate(254 424)">
              <path
                id="패스_288"
                data-name="패스 288"
                d="M76.01,74.216h1.229l-.615-1.746Z"
                transform="translate(-68.211 -65.034)"
              />
              <path
                id="패스_289"
                data-name="패스 289"
                d="M10.671,0C4.777,0,0,3.767,0,8.414c0,3,2,5.643,5,7.129-.163.563-1.051,3.626-1.086,3.867,0,0-.022.181.1.249a.322.322,0,0,0,.254.015c.337-.047,3.9-2.546,4.515-2.976a13.5,13.5,0,0,0,1.89.128c5.894,0,10.671-3.767,10.671-8.414S16.565,0,10.671,0ZM5.39,7.108c-.013,1.19.01,2.442-.009,3.614-.006.375-.222.486-.513.593a.193.193,0,0,1-.1.007c-.333-.066-.6-.185-.607-.6-.024-1.171.007-2.425-.009-3.615-.282-.011-.684.011-.946,0a.577.577,0,0,1-.6-.6.565.565,0,0,1,.606-.6c.962-.014,2.155-.014,3.117,0a.561.561,0,0,1,.605.6.578.578,0,0,1-.6.6C6.074,7.119,5.673,7.1,5.39,7.108Zm5.171,4.15a.948.948,0,0,1-.392.085.505.505,0,0,1-.513-.272l-.308-.8H7.475l-.308.8a.506.506,0,0,1-.513.272.94.94,0,0,1-.391-.085c-.17-.078-.333-.293-.147-.874L7.593,6.507A.923.923,0,0,1,8.414,5.9a.931.931,0,0,1,.821.608l1.471,3.874C10.894,10.965,10.731,11.184,10.561,11.258Zm3.111,0H11.7a.579.579,0,0,1-.59-.564V6.516a.629.629,0,0,1,1.257,0v3.617h1.308a.565.565,0,1,1,0,1.129Zm4.823-.464a.616.616,0,0,1-1.1.287L15.947,9.17l-.213.213v1.343a.616.616,0,1,1-1.231,0V6.52a.616.616,0,0,1,1.231,0v1.32l1.718-1.718a.476.476,0,0,1,.342-.137.624.624,0,0,1,.605.573.482.482,0,0,1-.134.375l-1.406,1.4,1.516,2.008a.616.616,0,0,1,.118.456Z"
              />
            </g>
          </g>
        </svg>
      </button>
    </div>
    <div class="google-login">
      <button @click="googleLogin">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          width="48"
          height="48"
          viewBox="0 0 55 55"
        >
          <defs>
            <clipPath id="clip-path">
              <path
                id="패스_155"
                data-name="패스 155"
                d="M21.023,10.057H11.847v3.8h5.282c-.492,2.417-2.551,3.8-5.282,3.8a5.819,5.819,0,1,1,0-11.637,5.693,5.693,0,0,1,3.625,1.3l2.865-2.865a9.841,9.841,0,1,0-6.49,17.232c4.923,0,9.4-3.581,9.4-9.847A8.169,8.169,0,0,0,21.023,10.057Z"
                transform="translate(-2 -2)"
              />
            </clipPath>
          </defs>
          <g id="그룹_248" data-name="그룹 248" transform="translate(-300 -406)">
            <g
              id="타원_6"
              data-name="타원 6"
              transform="translate(300 406)"
              fill="#fff"
              stroke="#eee"
              stroke-width="1"
            >
              <circle cx="27.5" cy="27.5" r="27.5" stroke="none" />
              <circle cx="27.5" cy="27.5" r="27" fill="none" />
            </g>
            <g id="Google__G__Logo" transform="translate(318 424)">
              <g id="그룹_114" data-name="그룹 114" clip-path="url(#clip-path)">
                <path
                  id="패스_154"
                  data-name="패스 154"
                  d="M0,22.637V11l7.609,5.819Z"
                  transform="translate(-0.895 -6.972)"
                  fill="#fbbc05"
                />
              </g>
              <g id="그룹_115" data-name="그룹 115" clip-path="url(#clip-path)">
                <path
                  id="패스_156"
                  data-name="패스 156"
                  d="M0,4.923l7.609,5.819,3.133-2.73L21.484,6.266V0H0Z"
                  transform="translate(-0.895 -0.895)"
                  fill="#ea4335"
                />
              </g>
              <g id="그룹_116" data-name="그룹 116" clip-path="url(#clip-path)">
                <path
                  id="패스_158"
                  data-name="패스 158"
                  d="M0,16.561,13.428,6.266l3.536.448L21.484,0V21.484H0Z"
                  transform="translate(-0.895 -0.895)"
                  fill="#34a853"
                />
              </g>
              <g id="그룹_117" data-name="그룹 117" clip-path="url(#clip-path)">
                <path
                  id="패스_160"
                  data-name="패스 160"
                  d="M28.666,27.561,14.79,16.819,13,15.476,28.666,11Z"
                  transform="translate(-8.077 -6.972)"
                  fill="#4285f4"
                />
              </g>
            </g>
          </g>
        </svg>
      </button>
    </div>
  </div>
</template>

<script>
/* eslint-disable no-unused-vars */
import KakaoAuth from "@/apis/KakaoApi.js";
import axios from "axios";
import UserApi from "@/apis/UserApi.js";

export default {
  name: "SocialLogin",

  methods: {
    async redirectSocialJoin() {
      var sns_token = sessionStorage.getItem("sns_token");
      var social_data = sessionStorage.getItem("social_data");
      console.log("re", sns_token);
      console.log("re", social_data);
      while(social_data == null){
        alert('아직')
      }
      if (social_data != "success") {
        this.$router.push("SocialJoin");
      } else {
        await UserApi.getID(res => {
          console.log(res)
        }).then(res => {
          console.log("vue id ", sessionStorage.getItem("id"));
          this.$router.push("Main");
        });
      }
    },
    kakaoLogin() {
      KakaoAuth.loginWithKakao().then(res => {
        this.redirectSocialJoin().then(res => {
          this.$router.go(0)
        });
      });
    },
    googleLogin() {
      this.handleClickGetAuth().then(res => {
        this.redirectSocialJoin().then(res => {
          this.$router.go(0)
        });
      });
    },
    async handleClickGetAuth() {
      await this.$gAuth
        .signIn()
        .then(GoogleUser => {
          //on success do something
          console.log("GoogleUser", GoogleUser["Ca"]);
          return axios
            .post("http://13.124.1.176/user/socialLogin", GoogleUser["Ca"])
            .then(response => {
              sessionStorage.setItem("sns_token", GoogleUser["Ca"]);
              sessionStorage.setItem("email", GoogleUser["Ca"]);
              sessionStorage.setItem("social_data", response.data.data.data);
              if(sessionStorage.getItem('social_data')=="success")
                sessionStorage.setItem("token", response.data.data.Authorization);
            });
        })
        .catch(error => {
          //on fail do something
          console.log(error);
        });
    }
  }
};

// getKakaoData() {

//       return KakaoAuth.loginWithKakao(
//          success callback
//         (res) => {
//           console.log("콜백나왔다"+res);
//         },
//          fail callback
//         (error) => {

//       });

//     },
</script>
